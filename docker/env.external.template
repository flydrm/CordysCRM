# ============================================================================
# Cordys CRM - 外部服务部署环境变量模板
# 
# 适用场景：方案3 - 使用外部 MySQL 和 Redis
# 
# 使用说明：
#   1. 复制此文件为 .env
#   2. 配置外部 MySQL 和 Redis 连接信息（必填项标有 [必填]）
#   3. 运行: docker compose -f docker-compose.external.yml up -d
#
# 安全提示：
#   - 生产环境请使用强密码
#   - .env 文件不要提交到版本控制
#   - 密码不会在命令行或进程列表中暴露
# ============================================================================

# ============================================================
# 基础配置
# ============================================================

# [可选] 镜像版本
CRM_VERSION=latest

# [可选] 时区
TZ=Asia/Shanghai

# ============================================================
# 端口配置（使用 Traefik 反代时可不暴露）
# ============================================================

# [可选] Web 应用端口（默认 8081）
WEB_PORT=8081

# [可选] MCP Server 端口（默认 8082）
MCP_PORT=8082

# ============================================================
# MySQL 外部服务配置 [必填]
# ============================================================

# [必填] MySQL 主机地址
MYSQL_HOST=your-mysql-host

# [可选] MySQL 端口（默认 3306）
MYSQL_PORT=3306

# [可选] 数据库名（默认 cordys-crm）
MYSQL_DATABASE=cordys-crm

# [可选] 数据库用户名（默认 cordys）
MYSQL_USERNAME=cordys

# [必填] 数据库密码
# 安全提示：支持特殊字符，如: MyP@ss!2024#Secure
MYSQL_PASSWORD=your-mysql-password

# [可选] 是否启用 SSL 连接（默认 false）
MYSQL_SSL=false

# [可选] SSL 模式（建议 VERIFY_CA 或 VERIFY_IDENTITY）
# MYSQL_SSL_MODE=VERIFY_CA

# [二选一，可选] MySQL CA 证书
# 1) 指定容器内已有的证书路径（推荐通过 volume 挂载）
# MYSQL_SSL_CA_PATH=/certs/aiven-mysql-ca.pem   # 或 /app/ca.txt（默认探测）
# 2) 直接填 PEM 内容（多行），脚本会写到 /opt/cordys/conf/mysql-ca.pem
# MYSQL_SSL_CA=-----BEGIN CERTIFICATE-----...-----END CERTIFICATE-----

# [可选] 连接池最小连接数（默认 5）
MYSQL_POOL_MIN=5

# [可选] 连接池最大连接数（默认 20）
MYSQL_POOL_MAX=20

# ============================================================
# Redis 外部服务配置 [必填]
# ============================================================

# [必填] Redis 主机地址
REDIS_HOST=your-redis-host

# [可选] Redis 端口（默认 6379）
REDIS_PORT=6379

# [视情况] Redis 密码（如果 Redis 配置了密码则必填）
REDIS_PASSWORD=your-redis-password

# [可选] 是否启用 Redis TLS（Aiven 等云服务通常需要，默认 true）
REDIS_SSL=true

# ============================================================
# JVM 配置
# ============================================================

# [可选] JVM 初始堆内存（默认 512m）
JVM_XMS=512m

# [可选] JVM 最大堆内存（默认 1024m）
# 建议：生产环境设置为可用内存的 50-70%
JVM_XMX=1024m

# ============================================================
# MCP Server 配置（AI 智能体）
# ============================================================

# [可选] 是否启用 MCP Server（默认 true）
MCP_ENABLED=true

# [推荐] CRM 系统外部访问 URL（用于 MCP 回调）
# 使用 Traefik 时填写实际域名
CRM_URL=https://crm.example.com

# ============================================================
# 会话配置
# ============================================================

# [可选] 会话超时时间（默认 30d）
SESSION_TIMEOUT=30d

# ============================================================
# SQLBot 智能问数配置（可选）
# ============================================================

# [可选] 是否加密 API 返回数据
SQLBOT_ENCRYPT=false

# [条件] AES 加密密钥（启用加密时必填，32字符）
# SQLBOT_AES_KEY=

# [条件] AES 初始化向量（启用加密时必填，16字符）
# SQLBOT_AES_IV=

# ============================================================
# 日志配置
# ============================================================

# [可选] 日志级别: DEBUG, INFO, WARN, ERROR
LOG_LEVEL=INFO

# ============================================================
# 数据目录配置
# ============================================================

# [可选] 数据存储路径（默认 ./data）
DATA_PATH=./data

# ============================================================
# 资源限制（生产环境推荐配置）
# ============================================================

# [可选] CPU 限制
LIMIT_CPU=4

# [可选] 内存限制
LIMIT_MEMORY=4G

# [可选] CPU 预留
RESERVE_CPU=1

# [可选] 内存预留
RESERVE_MEMORY=1G

# ============================================================
# Traefik 反代配置（可选）
# ============================================================

# [条件] 使用 Traefik 时的域名
TRAEFIK_DOMAIN=crm.example.com

# [条件] Traefik 网络名称
TRAEFIK_NETWORK=traefik-public
